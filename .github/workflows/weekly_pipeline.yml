name: "ğŸ“… Weekly BTC Prediction Pipeline"

on:
  # ë§¤ì£¼ ì›”ìš”ì¼ í•œêµ­ ì‹œê°„ ì˜¤ì „ 1ì‹œ (ì¼ìš”ì¼ UTC 16:00) ìë™ ì‹¤í–‰
  schedule:
    - cron: "0 16 * * 0"
  # ìˆ˜ë™ ì‹¤í–‰ í—ˆìš©
  workflow_dispatch:

jobs:
  weekly-pipeline:
    name: "Run Weekly Pipeline"
    runs-on: ubuntu-latest
    timeout-minutes: 60  # ìµœëŒ€ 1ì‹œê°„

    env:
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      FRED_API_KEY: ${{ secrets.FRED_API_KEY }}
      GITHUB_ACTIONS: "true"

    steps:
      - name: "ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ"
        uses: actions/checkout@v4

      - name: "ğŸ Python 3.10 ì„¤ì •"
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"
          cache: "pip"
          cache-dependency-path: "requirements_actions.txt"

      - name: "ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜"
        run: |
          pip install --upgrade pip
          pip install -r requirements_actions.txt

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Step 1: ì£¼ê°„ ë³€ë™ì„± ì˜ˆì¸¡ (ëª¨ë¸ ê°€ì¤‘ì¹˜ ìë™ ë‹¤ìš´ë¡œë“œ í¬í•¨)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ”® Step 1 - ì£¼ê°„ ë³€ë™ì„± ì˜ˆì¸¡ (32_weekly_predict)"
        run: python pipeline_04_weekly_predict.py

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Step 2: ì£¼ê°„+ì¼ê°„ ì¢…í•© ë§ˆì¼“ ë ˆí¬íŠ¸ ì‘ì„±
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ“ˆ Step 2 - ì£¼ê°„ ë§ˆì¼“ ë ˆí¬íŠ¸ (33_market_analysis)"
        run: python pipeline_05_weekly_report.py
