name: "ğŸ“ˆ Daily BTC Prediction Pipeline"

on:
  # ë§¤ì¼ í•œêµ­ ì‹œê°„ ì˜¤ì „ 1ì‹œ (UTC 16:00 ì „ë‚ ) ìë™ ì‹¤í–‰
  schedule:
    - cron: "0 16 * * *"
  # ìˆ˜ë™ ì‹¤í–‰ í—ˆìš©
  workflow_dispatch:

jobs:
  daily-pipeline:
    name: "Run Daily Pipeline"
    runs-on: ubuntu-latest
    timeout-minutes: 120  # ìµœëŒ€ 2ì‹œê°„

    env:
      SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
      SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      SUPABASE_SERVICE_KEY: ${{ secrets.SUPABASE_SERVICE_KEY }}
      OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      FRED_API_KEY: ${{ secrets.FRED_API_KEY }}
      GITHUB_ACTIONS: "true"

    steps:
      - name: "ğŸ“¥ ì½”ë“œ ì²´í¬ì•„ì›ƒ"
        uses: actions/checkout@v4

      - name: "ğŸ Python 3.10 ì„¤ì •"
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"
          cache: "pip"
          cache-dependency-path: "requirements_actions.txt"

      - name: "ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜"
        run: |
          pip install --upgrade pip
          pip install -r requirements_actions.txt
          pip install pygooglenews --no-deps

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Step 1: ë°ì´í„° í¬ë¡¤ë§ ë° DB ì €ì¥
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ•·ï¸ Step 1 - ë°ì´í„° í¬ë¡¤ë§ (29_COMPLETE_PIPELINE)"
        run: python pipeline_01_crawl.py

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Step 2: ì¼ê°„ AI ì˜ˆì¸¡ (ëª¨ë¸ ê°€ì¤‘ì¹˜ ìë™ ë‹¤ìš´ë¡œë“œ í¬í•¨)
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ¤– Step 2 - ì¼ê°„ ì˜ˆì¸¡ (31FH_daily_predict_v7E)"
        run: python pipeline_02_predict.py

      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      # Step 3: ì¼ê°„ ë ˆí¬íŠ¸ ìƒì„± ë° ì €ì¥
      # â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
      - name: "ğŸ“Š Step 3 - ì¼ê°„ ë ˆí¬íŠ¸ ìƒì„± (32FA_daily_report)"
        run: python pipeline_03_report.py
